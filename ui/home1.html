<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cisco Social - Home</title>
  <style>
    :root {
      --brand: #0f5ea8;
      --brand-strong: #0a4a84;
      --accent: #00bceb;
      --success: #0d8f5f;
      --bg: #eef3f8;
      --surface: #ffffff;
      --text: #12324f;
      --muted: #58708a;
      --ring: rgba(15, 94, 168, 0.25);
      --shadow: 0 8px 24px rgba(6, 28, 52, 0.12);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", "Helvetica Neue", "Trebuchet MS", sans-serif;
      margin: 0;
      background:
        radial-gradient(circle at 10% -10%, rgba(0, 188, 235, 0.12), transparent 32%),
        radial-gradient(circle at 90% 10%, rgba(15, 94, 168, 0.12), transparent 28%),
        var(--bg);
      color: var(--text);
    }

    header {
      background: linear-gradient(110deg, var(--brand) 0%, #1478c8 54%, #0f9ec8 100%);
      color: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      position: sticky;
      top: 0;
      z-index: 9;
      box-shadow: 0 3px 12px rgba(0, 34, 63, 0.22);
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    .search-bar input {
      padding: 0.55rem 0.8rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.55);
      width: min(340px, 42vw);
      outline: none;
      color: var(--text);
    }
    .search-bar input:focus {
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.35);
    }

    .container {
      display: flex;
      padding: 1.5rem;
      gap: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    .main-feed {
      flex: 3;
      background: var(--surface);
      padding: 1rem 1.5rem;
      border-radius: 14px;
      box-shadow: var(--shadow);
      max-height: 80vh;
      overflow-y: auto;
    }
    .sidebar {
      flex: 1.6;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .section {
      background: var(--surface);
      padding: 1rem 1.2rem;
      border-radius: 14px;
      box-shadow: var(--shadow);
    }
    h2 {
      margin-top: 0;
      font-size: 1.2rem;
      color: var(--brand);
      border-bottom: 2px solid rgba(15, 94, 168, 0.26);
      margin-bottom: 1rem;
    }
    button {
      cursor: pointer;
      background: var(--brand);
      border: none;
      color: white;
      padding: 7px 12px;
      border-radius: 6px;
      font-size: 0.9rem;
      transition: background-color 0.3s;
      user-select: none;
    }
    button:hover {
      background: var(--brand-strong);
    }
    button:focus-visible,
    input:focus-visible,
    textarea:focus-visible,
    select:focus-visible {
      outline: 3px solid var(--ring);
      outline-offset: 1px;
    }
    .webex-btn {
      background: var(--success);
      color: white;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 0.85rem;
      border: none;
      margin-left: 10px;
      user-select: none;
      white-space: nowrap;
    }
    .webex-btn:hover {
      background: #008930;
    }
    .wish-btn {
      background: #338034;
      color: white;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.85rem;
      margin-left: 10px;
      user-select: none;
      white-space: nowrap;
    }
    .wish-btn:hover {
      background: #276628;
    }
    .actions {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      align-items: center;
    }
    .actions button {
      flex: 1 1 140px;
      font-weight: 600;
      min-width: 120px;
    }
    .feed-tools {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }
    .feed-status {
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
      font-weight: 600;
    }
    .pill {
      border: 1px solid rgba(15, 94, 168, 0.3);
      background: #f6fbff;
      color: var(--brand);
      border-radius: 999px;
      padding: 5px 10px;
      font-size: 0.8rem;
      font-weight: 700;
    }
    .post,
    .poll {
      margin-bottom: 1.2rem;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
    }

    .post h3,
    .poll-question {
      margin: 0.2rem 0 0.5rem;
      color: var(--brand-strong);
    }
    .post time,
    .poll time {
      font-size: 0.85rem;
      color: #666;
      margin-left: 8px;
    }
    .post-tags span {
      background: #d9e9fe;
      color: var(--brand-strong);
      padding: 2px 6px;
      margin-right: 6px;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
      user-select: none;
    }

    .post-actions,
    .poll-actions {
      display: flex;
      gap: 12px;
      margin-top: 6px;
    }
    button:hover {
      filter: brightness(0.95);
    }
    .poll-block {
      background: #ecf4fe;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
    }
    .poll-options {
      list-style-type: none;
      padding: 0;
      margin: 0 0 12px 0;
      user-select: none;
    }
    .poll-options li {
      margin: 5px 0;
    }
    .poll-results {
      color: var(--brand-strong);
      font-weight: 600;
    }
    .poll-results span {
      margin-right: 20px;
      font-size: 0.9rem;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.3);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal.show {
      display: flex;
    }
    .modal-content {
      background: var(--surface);
      width: 420px;
      max-width: 90vw;
      padding: 20px 24px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      position: relative;
      user-select: none;
    }
    .video-preview-box {
      border: 1px solid #c7d4e2;
      border-radius: 10px;
      background: #f7fbff;
      padding: 10px;
      color: #27415d;
      font-size: 0.92rem;
    }
    .video-preview-state {
      margin-top: 6px;
      color: #46698d;
      font-weight: 600;
    }
    .close-btn {
      position: static;
      font-size: 22px;
      font-weight: bold;
      color: #999;
      cursor: pointer;
      user-select: none;
      margin-left: 30px;
    }
    .close-btn:hover {
      color: #555;
    }
    .group-header-wrapper {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .group-header-wrapper .group-name {
      cursor: pointer;
      flex-grow: 1;
      background: #eef6ff;
      color: var(--brand-strong);
      font-weight: 600;
      padding: 8px 14px;
      border-radius: 8px;
      user-select: none;
      transition: background-color 0.2s;
    }
    .group-header-wrapper .group-name:hover {
      background: #d3e4ff;
    }
    .group-members {
      margin-left: 24px;
      border-left: 3px solid var(--brand);
      padding-left: 12px;
      color: #444;
      user-select: none;
    }
    .empty-state {
      color: var(--muted);
      font-weight: 600;
      padding: 8px 0;
    }
    .toast {
      position: fixed;
      right: 16px;
      bottom: 16px;
      background: #07325f;
      color: #fff;
      padding: 10px 14px;
      border-radius: 10px;
      box-shadow: var(--shadow);
      opacity: 0;
      pointer-events: none;
      transform: translateY(8px);
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 1200;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    .content-input {
      width: 100%;
      padding: 8px;
      margin-bottom: 8px;
      border-radius: 8px;
      border: 1px solid #c7d4e2;
      font: inherit;
    }
    .content-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }
    .photo-preview-wrap {
      margin-bottom: 10px;
      min-height: 48px;
      border: 1px dashed #b8cbde;
      border-radius: 10px;
      background: #f9fcff;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      color: var(--muted);
      font-size: 0.9rem;
      font-weight: 600;
    }
    .photo-preview-wrap.dragover {
      border-color: var(--brand);
      background: #eaf5ff;
      color: var(--brand);
    }
    .photo-preview {
      max-width: 100%;
      max-height: 260px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
      object-fit: cover;
    }
    .post-image {
      margin-top: 10px;
      max-width: min(560px, 100%);
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(8, 30, 56, 0.18);
    }
    @media (max-width: 1000px) {
      .container {
        flex-direction: column;
        padding: 1rem;
      }
      .main-feed {
        max-height: none;
      }
      .sidebar {
        gap: 1rem;
      }
    }
    @media (max-width: 680px) {
      header {
        padding: 0.8rem 1rem;
        flex-direction: column;
        align-items: flex-start;
      }
      .search-bar input {
        width: 100%;
      }
      .actions button {
        flex: 1 1 calc(50% - 8px);
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>Cisco Social</h1>
    <div class="search-bar">
      <input id="globalSearch" type="search" placeholder="Search posts, polls, people..." />
    </div>
  </header>
  <div class="container">
    <main class="main-feed">
      <div class="actions">
        <button id="postsBtn">Posts</button>
        <button id="groupsBtn">Groups</button>
        <button id="sendRecognitionBtn">Recognition</button>
        <button id="photoUploadBtn">Upload Photo</button>
        <button id="quickPollBtn">Quick Poll</button>
        <button id="callBtn" aria-label="Make a Webex call">üìû Call</button>
        <button id="videoCallBtn" aria-label="Start a Webex video call">üé• Video Call</button>
      </div>
      <div class="feed-tools">
        <p id="feedStatus" class="feed-status">Showing all feed items</p>
        <span id="feedCount" class="pill">0 items</span>
      </div>
      <div id="postsContainer"></div>
      <div id="postCreation" style="display: none; margin-top: 1rem;">
        <h3>Create Post</h3>
        <input id="postTitle" class="content-input" type="text" placeholder="Title" />
        <textarea id="postContent" class="content-input" placeholder="What's on your mind?" style="height: 90px"></textarea>
        <input id="postTags" class="content-input" type="text" placeholder="Tags (comma separated)" />
        <select id="postBU" multiple class="content-input">
          <option value="All">All</option>
          <option value="Marketing">Marketing</option>
          <option value="Engineering">Engineering</option>
          <option value="Sales">Sales</option>
          <option value="HR">HR</option>
        </select>
        <div class="content-actions">
          <button id="postCancel" style="background:#7b8da2;">Cancel</button>
          <button id="postSubmit">Post</button>
        </div>
      </div>
      <div id="pollCreation" style="display: none; margin-top: 1rem;">
        <h3>Create Quick Poll</h3>
        <input id="pollQuestion" class="content-input" placeholder="Poll question" />
        <textarea id="pollOptions" class="content-input" placeholder="One option per line" style="height: 90px"></textarea>
        <select id="pollBU" multiple class="content-input">
          <option value="All">All</option>
          <option value="Marketing">Marketing</option>
          <option value="Engineering">Engineering</option>
          <option value="Sales">Sales</option>
          <option value="HR">HR</option>
        </select>
        <div class="content-actions">
          <button id="pollCancel" style="background:#7b8da2;">Cancel</button>
          <button id="pollSubmit">Post</button>
        </div>
      </div>
      <div id="photoCreation" style="display: none; margin-top: 1rem;">
        <h3>Upload Photo</h3>
        <input id="photoTitle" class="content-input" type="text" placeholder="Photo title" />
        <textarea id="photoCaption" class="content-input" placeholder="Add a caption (optional)" style="height: 90px"></textarea>
        <input id="photoFile" class="content-input" type="file" accept="image/*" />
        <div id="photoPreviewWrap" class="photo-preview-wrap">No photo selected. Drag and drop an image here.</div>
        <select id="photoBU" multiple class="content-input">
          <option value="All">All</option>
          <option value="Marketing">Marketing</option>
          <option value="Engineering">Engineering</option>
          <option value="Sales">Sales</option>
          <option value="HR">HR</option>
        </select>
        <div class="content-actions">
          <button id="photoCancel" style="background:#7b8da2;">Cancel</button>
          <button id="photoSubmit">Upload</button>
        </div>
      </div>
    </main>
    <aside class="sidebar">
      <section class="section">
        <h2>Upcoming Events</h2>
        <div>Wellness Webinar - Aug 25 <button>RSVP</button></div>
        <div>Team Coffee Chat - Aug 22 <button>RSVP</button></div>
        <div>Cisco Content Expo - March 2026 <button>RSVP</button></div>
      </section>
      <section class="section">
        <h2>Job Opportunities</h2>
        <div>Data Scientist - New York <button>Apply</button></div>
        <div>UX Designer - Remote <button>Apply</button></div>
        <div>Cloud Engineer - San Francisco <button>Apply</button></div>
      </section>
      <section class="section">
        <h2>New Hires</h2>
        <div class="new-hire">
          Emma L. (Marketing) <button class="wish-btn" onclick="wishGoodLuck('Emma L.')">Wish</button>
        </div>
        <div class="new-hire">
          Raj S. (Engineering) <button class="wish-btn" onclick="wishGoodLuck('Raj S.')">Wish</button>
        </div>
        <div class="new-hire">
          Sara P. (HR) <button class="wish-btn" onclick="wishGoodLuck('Sara P.')">Wish</button>
        </div>
      </section>
      <section class="section">
        <h2>Work Anniversaries</h2>
        <div>John M. - 5 Years</div>
        <div>Alice R. - 3 Years</div>
        <div>David K. - 1 Year</div>
      </section>
      <section class="section">
        <h2>Notifications</h2>
        <div>New message from Sarah J.</div>
        <div>You received a badge from Raj P.</div>
        <div>Project deadline updated</div>
      </section>
    </aside>
  </div>
  <!-- Groups Modal with "New" button aligned and spaced to the right of heading -->
  <div id="groupsModal" class="modal">
    <div class="modal-content">
      <div style="display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; align-items: center;">
          <h2 style="margin: 0;">Groups</h2>
          <button id="groupsNewBtn" style="margin-left: 24px; font-size: 1rem; padding: 7px 18px;">New</button>
        </div>
        <button id="groupsModalClose" class="close-btn" style="margin-left: 35px;">&times;</button>
      </div>
      <div id="groupsContainer" style="margin-top: 1.1rem;"></div>
      <div id="groupCreationForm" style="display:none; margin-top: 1rem;">
        <input id="groupNameInput" type="text" placeholder="Group Name" style="width: 100%; padding: 8px; margin-bottom: 8px" />
        <textarea id="groupCriteriaInput" placeholder="Criteria (skills, departments)" style="width: 100%; padding: 8px; margin-bottom: 8px; height: 80px"></textarea>
        <button id="groupCreateSubmitBtn">Create Group</button>
      </div>
    </div>
  </div>
  <!-- Shout Out Modal -->
  <!-- Call Modal -->
  <div id="callModal" class="modal">
    <div class="modal-content">
      <div style="display:flex; align-items:center; justify-content: space-between; margin-bottom: 8px;">
        <h2 style="margin:0;">Make a Webex Call</h2>
        <button id="callCloseBtn" class="close-btn" aria-label="Close call form">&times;</button>
      </div>
      <div style="display:flex; flex-direction:column; gap:10px;">
        <input id="callCountry" type="text" placeholder="Country code (e.g., +1)" style="width: 100%; padding: 8px;" />
        <input id="callNumber" type="tel" placeholder="Mobile number" style="width: 100%; padding: 8px;" />
        <div style="display:flex; gap:10px; justify-content:flex-end;">
          <button id="callCancelBtn" style="background:#888;">Cancel</button>
          <button id="callStartBtn">Call</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Video Call Modal -->
  <div id="videoCallModal" class="modal">
    <div class="modal-content">
      <div style="display:flex; align-items:center; justify-content: space-between; margin-bottom: 8px;">
        <h2 style="margin:0;">Start a Video Call</h2>
        <button id="videoCallCloseBtn" class="close-btn" aria-label="Close video call form">&times;</button>
      </div>
      <div style="display:flex; flex-direction:column; gap:10px;">
        <input id="videoTopic" type="text" placeholder="Meeting topic" style="width: 100%; padding: 8px;" />
        <input id="videoParticipant" type="email" placeholder="Participant email address" style="width: 100%; padding: 8px;" />
        <label style="display:flex; align-items:center; gap:8px;">
          <input id="videoCameraToggle" type="checkbox" checked />
          Camera on at start
        </label>
        <label style="display:flex; align-items:center; gap:8px;">
          <input id="videoMicToggle" type="checkbox" checked />
          Microphone on at start
        </label>
        <div class="video-preview-box">
          <div><strong>Preview:</strong> You are ready to join as <span id="videoPreviewName">Host</span></div>
          <div id="videoPreviewState" class="video-preview-state">Camera: On | Mic: On</div>
        </div>
        <div style="display:flex; gap:10px; justify-content:flex-end;">
          <button id="videoCallCancelBtn" style="background:#888;">Cancel</button>
          <button id="videoCallStartBtn">Start Video Call</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    // DATA
    const employees = [
      { name: 'Emma L.', skills: ['Marketing', 'AI'] },
      { name: 'Raj S.', skills: ['Engineering', 'Machine Learning'] },
      { name: 'Sara P.', skills: ['HR'] },
      { name: 'David K.', skills: ['Engineering', 'AI'] },
      { name: 'Alice R.', skills: ['UX Design', 'AI'] },
      { name: 'John M.', skills: ['Marketing'] },
      { name: 'Priya S.', skills: ['AI', 'Engineering'] },
      { name: 'Chris W.', skills: ['UX Design', 'Machine Learning'] },
      { name: 'Megan G.', skills: ['Engineering', 'AI'] },
      { name: 'Luis Q.', skills: ['Engineering', 'AI', 'UX Design'] },
      { name: 'Brian Z.', skills: ['Machine Learning', 'Engineering'] },
      { name: 'Mei T.', skills: ['AI', 'UX Design'] },
      { name: 'Anil R.', skills: ['Marketing', 'Engineering'] }
    ];

    let groups = [
      // CHANGED "Marketers" group to "Python Group" and set Webex link
      { name: "AI Engineers", criteria: ["ai", "machine learning", "engineering"], members: ["Raj S.", "David K.", "Priya S.", "Megan G.", "Brian Z."], webex: "https://webex.com/meet/ai-engineers" },
      { name: "UX Designers", criteria: ["ux design"], members: ["Alice R.", "Chris W.", "Luis Q.", "Mei T."], webex: "https://webex.com/meet/ux-designers" },
      { name: "Python Group", criteria: ["marketing"], members: ["Emma L.", "John M.", "Anil R.", "Sara P."], webex: "https://cisco.webex.com/meet/gisankar" }, // <-- changed
      { name: "ML Innovators", criteria: ["machine learning"], members: ["Raj S.", "Chris W.", "Brian Z.", "Priya S."], webex: "https://webex.com/meet/ml-innovators" }
    ];

    let posts = [
      { type: 'post', author: 'Lisa T.', date: '2025-08-20', title: 'Great teamwork on Q3 launch', content: 'Shoutout to team!', tags: ['#Q3', '#Success'], bu: ['All'] },
      { type: 'poll', author: 'HR Team', date: '2025-08-18', question: 'Do you like the new WFH policy?', options: ['Yes', 'No', 'Not Sure'], votes: [12, 5, 3], voters: {}, bu: ['All'] }
    ];
    let activeQuery = '';
    let toastTimer;

    const postsContainer = document.getElementById('postsContainer');
    const postCreation = document.getElementById('postCreation');
    const pollCreation = document.getElementById('pollCreation');
    const photoCreation = document.getElementById('photoCreation');
    const groupsModal = document.getElementById('groupsModal');
    const groupCreationForm = document.getElementById('groupCreationForm');
    const groupsContainer = document.getElementById('groupsContainer');
    const callModal = document.getElementById('callModal');
    const videoCallModal = document.getElementById('videoCallModal');
    const feedStatus = document.getElementById('feedStatus');
    const feedCount = document.getElementById('feedCount');

    function hideForms() {
      postCreation.style.display = 'none';
      pollCreation.style.display = 'none';
      photoCreation.style.display = 'none';
      groupsModal.style.display = 'none';
      groupCreationForm.style.display = 'none';
      groupsContainer.innerHTML = '';
      closeCall();
      closeVideoCall();
    }

    // Toolbar event listeners
    document.getElementById('postsBtn').onclick = () => {
      hideForms();
      postCreation.style.display = 'block';
    };
    document.getElementById('quickPollBtn').onclick = () => {
      hideForms();
      pollCreation.style.display = 'block';
    };
    document.getElementById('photoUploadBtn').onclick = () => {
      hideForms();
      photoCreation.style.display = 'block';
    };
    document.getElementById('sendRecognitionBtn').onclick = () => {
      showToast('Recognition feature coming soon.');
      hideForms();
    };
    document.getElementById('groupsBtn').onclick = () => {
      hideForms();
      groupsModal.style.display = 'flex';
      showGroups();
    };
    document.getElementById('callBtn').onclick = () => {
      hideForms();
      callModal.classList.add('show');
      document.getElementById('callCountry').focus();
    };
    document.getElementById('videoCallBtn').onclick = () => {
      hideForms();
      videoCallModal.classList.add('show');
      document.getElementById('videoTopic').focus();
      updateVideoPreview();
    };
    // Groups modal logic
    document.getElementById('groupsModalClose').onclick = () => {
      groupsModal.style.display = 'none';
      groupCreationForm.style.display = 'none';
      groupsContainer.innerHTML = '';
    };
    document.getElementById('groupsNewBtn').onclick = () => {
      groupsContainer.innerHTML = '';
      groupCreationForm.style.display = 'block';
    };
    window.onclick = function (e) {
      if (e.target === groupsModal) {
        groupsModal.style.display = 'none';
        groupCreationForm.style.display = 'none';
        groupsContainer.innerHTML = '';
      }
      if (e.target === callModal) {
        closeCall();
      }
      if (e.target === videoCallModal) {
        closeVideoCall();
      }
    };

    document.getElementById('groupCreateSubmitBtn').onclick = () => {
      const name = document.getElementById('groupNameInput').value.trim();
      const criteriaText = document.getElementById('groupCriteriaInput').value.trim();
      if (!name || !criteriaText) {
        alert('Please fill both Group Name and Criteria.');
        return;
      }
      const criteria = criteriaText.split(',').map(c => c.trim().toLowerCase());
      const members = employees.filter(e => e.skills.some(s => criteria.includes(s.toLowerCase()))).map(e => e.name);
      // If creating "Python Group", always use the special Cisco Webex link
      const url = name.toLowerCase() === 'python group'
        ? 'https://cisco.webex.com/meet/gisankar'
        : `https://webex.com/meet/${encodeURIComponent(name.toLowerCase().replace(/\s+/g, '-'))}`;
      groups.push({ name, criteria, members, webex: url });
      groupCreationForm.style.display = 'none';
      document.getElementById('groupNameInput').value = '';
      document.getElementById('groupCriteriaInput').value = '';
      showGroups();
      showToast(`Group "${name}" created (${members.length} members).`);
    };

    // Call form handlers
    document.getElementById('callCloseBtn').onclick = closeCall;
    document.getElementById('callCancelBtn').onclick = closeCall;
    document.getElementById('callStartBtn').onclick = () => {
      const cc = document.getElementById('callCountry').value.trim();
      const num = document.getElementById('callNumber').value.trim();
      if (!cc || !num) {
        showToast('Please enter both country code and mobile number.');
        return;
      }
      if (!/^\+\d{1,3}$/.test(cc) || !/^\d{6,15}$/.test(num.replace(/\s+/g, ''))) {
        showToast('Enter country code like +1 and a valid phone number.');
        return;
      }
      showToast(`Starting Webex call to ${cc} ${num}...`);
      closeCall();
    };
    // Video Call handlers
    document.getElementById('videoCallCloseBtn').onclick = closeVideoCall;
    document.getElementById('videoCallCancelBtn').onclick = closeVideoCall;
    document.getElementById('videoCameraToggle').onchange = updateVideoPreview;
    document.getElementById('videoMicToggle').onchange = updateVideoPreview;
    document.getElementById('videoTopic').oninput = updateVideoPreview;
    document.getElementById('videoCallStartBtn').onclick = () => {
      const topic = document.getElementById('videoTopic').value.trim();
      const participant = document.getElementById('videoParticipant').value.trim();
      if (!topic || !participant) {
        showToast('Please enter a meeting topic and participant email.');
        return;
      }
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(participant)) {
        showToast('Enter a valid participant email.');
        return;
      }
      const cameraOn = document.getElementById('videoCameraToggle').checked;
      const micOn = document.getElementById('videoMicToggle').checked;
      const webexUrl = `https://cisco.webex.com/meet/gisankar?topic=${encodeURIComponent(topic)}&cam=${cameraOn ? 'on' : 'off'}&mic=${micOn ? 'on' : 'off'}`;
      window.open(webexUrl, '_blank');
      showToast(`Video call started for "${topic}" with ${participant}.`);
      closeVideoCall();
    };

    function showGroups() {
      groupsContainer.innerHTML = '';
      groups.forEach((g, idx) => {
        const div = document.createElement('div');
        div.style.marginBottom = '12px';

        const header = document.createElement('div');
        header.className = 'group-header-wrapper';

        const nameDiv = document.createElement('div');
        nameDiv.className = 'group-name';
        nameDiv.textContent = g.name;
        nameDiv.onclick = () => showMembers(idx);

        const meetBtn = document.createElement('button');
        meetBtn.className = 'webex-btn';
        meetBtn.textContent = 'Meet';
        // For Python Group, use the special Cisco Webex link
        meetBtn.onclick = (e) => {
          e.stopPropagation();
          if (g.name.toLowerCase() === 'python group') {
            window.open('https://cisco.webex.com/meet/gisankar', '_blank');
          } else {
            window.open(g.webex, '_blank');
          }
        };

        header.appendChild(nameDiv);
        header.appendChild(meetBtn);
        div.appendChild(header);

        groupsContainer.appendChild(div);
      });
    }

    function showMembers(idx) {
      const g = groups[idx];
      // For Python Group, use the special Cisco Webex link
      const meetUrl = g.name.toLowerCase() === 'python group'
        ? 'https://cisco.webex.com/meet/gisankar'
        : g.webex;
      groupsContainer.innerHTML = `
        <div class="group-header-wrapper">
          <div class="group-name">${g.name}</div>
          <button class="webex-btn" onclick="window.open('${meetUrl}', '_blank')">Meet</button>
        </div>
        <div class="group-members"><strong>Members:</strong><br>${g.members.join('<br>')}</div>
      `;
    }

    // Posts and Polls rendering and controls
    function renderPosts() {
      postsContainer.innerHTML = '';
      const filtered = posts.filter(postMatchesQuery);
      feedStatus.textContent = activeQuery ? `Filtered by "${activeQuery}"` : 'Showing all feed items';
      feedCount.textContent = `${filtered.length} item${filtered.length === 1 ? '' : 's'}`;

      if (filtered.length === 0) {
        postsContainer.innerHTML = '<p class="empty-state">No feed items match your search.</p>';
        return;
      }

      filtered.forEach((post, idx) => {
        if (post.type === 'post') {
          const div = document.createElement('div');
          div.className = 'post';
          div.innerHTML = `
            <strong>${sanitize(post.author)}</strong> <time>${sanitize(post.date)}</time>
            <h3>${sanitize(post.title)}</h3>
            <p>${sanitize(post.content)}</p>
            ${post.image ? `<img class="post-image" src="${sanitize(post.image)}" alt="${sanitize(post.title || 'Uploaded photo')}" />` : ''}
            <div class="post-tags">${post.tags.map(t => `<span>${sanitize(t)}</span>`).join('')}</div>
            <div><em>Visible to: ${sanitize(post.bu.join(', '))}</em></div>
            <div><button>üëç Like</button><button>üí¨ Comment</button><button>üîÑ Share</button></div>
          `;
          postsContainer.appendChild(div);
        } else if (post.type === 'poll') {
          postsContainer.appendChild(renderPoll(post, idx));
        }
      });
    }

    function renderPoll(post, idx) {
      const div = document.createElement('div');
      div.className = 'poll';
      div.innerHTML = `
        <strong>${sanitize(post.author)}</strong> <time>${sanitize(post.date)}</time>
        <div class="poll-block">
          <div class="poll-question">${sanitize(post.question)}</div>
          <div><em>Visible to: ${sanitize(post.bu.join(', '))}</em></div>
          <div id="pollArea${idx}"></div>
        </div>
      `;
      const pollArea = div.querySelector(`#pollArea${idx}`);

      if (!(post.voters && post.voters['demo-user'])) {
        const form = document.createElement('form');
        form.innerHTML = post.options.map((opt, oidx) => `
          <label style="display:block;margin:4px 0">
            <input type="radio" name="opt${idx}" value="${oidx}"/> ${sanitize(opt)}
          </label>`).join('') + `<button type="submit">Vote</button>`;
        form.onsubmit = e => {
          e.preventDefault();
          const sel = form.querySelector('input[name=opt' + idx + ']:checked');
          if (!sel) return;
          if (!post.voters) post.voters = {};
          post.voters['demo-user'] = sel.value;
          post.votes[sel.value] = (post.votes[sel.value] || 0) + 1;
          renderPosts();
        };
        pollArea.appendChild(form);
      } else {
        const totalVotes = post.votes.reduce((a, b) => a + b, 0) || 1;
        let html = '';
        post.options.forEach((opt, i) => {
          const pct = Math.round((post.votes[i] || 0) * 100 / totalVotes);
          html += `<span>${sanitize(opt)}: ${pct}% (${post.votes[i] || 0})</span> `;
        });
        pollArea.innerHTML = `<div class="poll-results">${html}</div><div>Thanks for voting!</div>`;
      }

      return div;
    }

    function postMatchesQuery(post) {
      if (!activeQuery) return true;
      const q = activeQuery.toLowerCase();
      if (post.type === 'post') {
        return [post.author, post.title, post.content, post.tags.join(' '), post.bu.join(' ')].join(' ').toLowerCase().includes(q);
      }
      return [post.author, post.question, post.options.join(' '), post.bu.join(' ')].join(' ').toLowerCase().includes(q);
    }

    function sanitize(str) {
      return String(str).replace(/[&<>"']/g, function (m) {
        return ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[m];
      });
    }

    function wishGoodLuck(name) {
      showToast(`Good luck wishes sent to ${name}!`);
    }
    window.wishGoodLuck = wishGoodLuck;

    document.getElementById('postCancel').onclick = () => {
      postCreation.style.display = 'none';
      clearPostForm();
    };
    document.getElementById('pollCancel').onclick = () => {
      pollCreation.style.display = 'none';
      clearPollForm();
    };
    document.getElementById('photoCancel').onclick = () => {
      photoCreation.style.display = 'none';
      clearPhotoForm();
    };

    function clearPostForm() {
      document.getElementById('postTitle').value = '';
      document.getElementById('postContent').value = '';
      document.getElementById('postTags').value = '';
      document.getElementById('postBU').selectedIndex = 0;
    }

    function clearPollForm() {
      document.getElementById('pollQuestion').value = '';
      document.getElementById('pollOptions').value = '';
      document.getElementById('pollBU').selectedIndex = 0;
    }

    function clearPhotoForm() {
      document.getElementById('photoTitle').value = '';
      document.getElementById('photoCaption').value = '';
      document.getElementById('photoFile').value = '';
      document.getElementById('photoBU').selectedIndex = 0;
      document.getElementById('photoPreviewWrap').innerHTML = 'No photo selected. Drag and drop an image here.';
    }

    function closeCall() {
      document.getElementById('callCountry').value = '';
      document.getElementById('callNumber').value = '';
      callModal.classList.remove('show');
    }

    function updateVideoPreview() {
      const topic = document.getElementById('videoTopic').value.trim();
      const cameraOn = document.getElementById('videoCameraToggle').checked;
      const micOn = document.getElementById('videoMicToggle').checked;
      document.getElementById('videoPreviewName').textContent = topic || 'Host';
      document.getElementById('videoPreviewState').textContent = `Camera: ${cameraOn ? 'On' : 'Off'} | Mic: ${micOn ? 'On' : 'Off'}`;
    }

    function closeVideoCall() {
      document.getElementById('videoTopic').value = '';
      document.getElementById('videoParticipant').value = '';
      document.getElementById('videoCameraToggle').checked = true;
      document.getElementById('videoMicToggle').checked = true;
      updateVideoPreview();
      videoCallModal.classList.remove('show');
    }

    function getSelectedValues(selectId) {
      const options = Array.from(document.getElementById(selectId).selectedOptions).map(o => o.value);
      return options.length ? options : ['All'];
    }

    function formatDate(date = new Date()) {
      return date.toISOString().slice(0, 10);
    }

    function showToast(message) {
      let toast = document.getElementById('appToast');
      if (!toast) {
        toast = document.createElement('div');
        toast.id = 'appToast';
        toast.className = 'toast';
        document.body.appendChild(toast);
      }
      toast.textContent = message;
      toast.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toast.classList.remove('show'), 2200);
    }

    document.getElementById('postSubmit').onclick = () => {
      const title = document.getElementById('postTitle').value.trim();
      const content = document.getElementById('postContent').value.trim();
      const rawTags = document.getElementById('postTags').value.trim();
      if (!title || !content) {
        showToast('Post title and content are required.');
        return;
      }
      const tags = rawTags
        ? rawTags.split(',').map(t => t.trim()).filter(Boolean).map(t => t.startsWith('#') ? t : `#${t}`)
        : ['#Update'];
      posts.unshift({
        type: 'post',
        author: 'You',
        date: formatDate(),
        title,
        content,
        tags,
        bu: getSelectedValues('postBU')
      });
      clearPostForm();
      postCreation.style.display = 'none';
      renderPosts();
      showToast('Post published.');
    };

    document.getElementById('pollSubmit').onclick = () => {
      const question = document.getElementById('pollQuestion').value.trim();
      const options = document.getElementById('pollOptions').value
        .split('\n')
        .map(o => o.trim())
        .filter(Boolean);
      if (!question || options.length < 2) {
        showToast('Add a poll question and at least 2 options.');
        return;
      }
      posts.unshift({
        type: 'poll',
        author: 'You',
        date: formatDate(),
        question,
        options,
        votes: new Array(options.length).fill(0),
        voters: {},
        bu: getSelectedValues('pollBU')
      });
      clearPollForm();
      pollCreation.style.display = 'none';
      renderPosts();
      showToast('Poll posted.');
    };

    document.getElementById('globalSearch').addEventListener('input', (e) => {
      activeQuery = e.target.value.trim();
      renderPosts();
    });

    document.getElementById('photoFile').addEventListener('change', (e) => {
      const [file] = e.target.files || [];
      setPhotoFile(file);
    });

    function setPhotoFile(file) {
      const previewWrap = document.getElementById('photoPreviewWrap');
      const photoInput = document.getElementById('photoFile');
      if (!file) {
        previewWrap.textContent = 'No photo selected. Drag and drop an image here.';
        return false;
      }
      if (!file.type.startsWith('image/')) {
        showToast('Please select an image file.');
        photoInput.value = '';
        previewWrap.textContent = 'No photo selected. Drag and drop an image here.';
        return false;
      }
      const dt = new DataTransfer();
      dt.items.add(file);
      photoInput.files = dt.files;
      const reader = new FileReader();
      reader.onload = () => {
        previewWrap.innerHTML = `<img class="photo-preview" src="${sanitize(reader.result)}" alt="Photo preview" />`;
      };
      reader.readAsDataURL(file);
      return true;
    }

    const photoPreviewWrap = document.getElementById('photoPreviewWrap');
    ['dragenter', 'dragover'].forEach((evt) => {
      photoPreviewWrap.addEventListener(evt, (e) => {
        e.preventDefault();
        e.stopPropagation();
        photoPreviewWrap.classList.add('dragover');
      });
    });
    ['dragleave', 'drop'].forEach((evt) => {
      photoPreviewWrap.addEventListener(evt, (e) => {
        e.preventDefault();
        e.stopPropagation();
        photoPreviewWrap.classList.remove('dragover');
      });
    });
    photoPreviewWrap.addEventListener('drop', (e) => {
      const [file] = e.dataTransfer.files || [];
      setPhotoFile(file);
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        groupsModal.style.display = 'none';
        closeCall();
        closeVideoCall();
        groupCreationForm.style.display = 'none';
      }
    });

    document.getElementById('photoSubmit').onclick = () => {
      const title = document.getElementById('photoTitle').value.trim();
      const caption = document.getElementById('photoCaption').value.trim();
      const file = document.getElementById('photoFile').files[0];
      if (!title || !file) {
        showToast('Photo title and image are required.');
        return;
      }
      const reader = new FileReader();
      reader.onload = () => {
        posts.unshift({
          type: 'post',
          author: 'You',
          date: formatDate(),
          title,
          content: caption || 'Shared a new photo.',
          image: reader.result,
          tags: ['#Photo'],
          bu: getSelectedValues('photoBU')
        });
        clearPhotoForm();
        photoCreation.style.display = 'none';
        renderPosts();
        showToast('Photo uploaded to feed.');
      };
      reader.readAsDataURL(file);
    };

    renderPosts();
  </script>
</body>
</html>
