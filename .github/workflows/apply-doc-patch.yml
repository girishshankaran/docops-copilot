name: Apply Doc Patch (template)

on:
  issue_comment:
    types: [created]

jobs:
  apply:
    if: contains(github.event.comment.body, '/apply-doc-patch')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Extract patch from comment
        run: |
          echo "${{ github.event.comment.body }}" \
            | awk 'BEGIN{f=0}/```patch/{f=1;next}/```/{f=0}f' > /tmp/doc.patch
      - name: Apply patch
        run: git apply /tmp/doc.patch
      - name: Lint/Build
        run: |
          npm ci
          npm run lint --if-present
          npm run build --if-present
      - name: Commit & push
        env:
          GIT_AUTHOR_NAME: doc-bot
          GIT_AUTHOR_EMAIL: doc-bot@users.noreply.github.com
          GIT_COMMITTER_NAME: doc-bot
          GIT_COMMITTER_EMAIL: doc-bot@users.noreply.github.com
        run: |
          git checkout -B doc-bot/${{ github.run_id }}
          git add .
          git commit -m "Docs: auto-update from code change"
          git push --force origin HEAD
